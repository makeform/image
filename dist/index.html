<div><style type="text/css">.image-base{background:0}img{max-width:100%;max-height:80vh;width:100%;object-fit:contain}.crop .image-base{display:flex;align-items:center;justify-content:center;background-size:contain;background-position:center center;position:relative}.crop .image-base:before{content:" ";display:block;position:absolute;inset:0;background:#000;background-image:repeating-linear-gradient(45deg,#000 0,#000 5px,#111 5px,#111 10px);opacity:.7;z-index:0}.crop img{z-index:1;object-fit:cover;object-position:center center;width:auto;height:100%;outline:1px solid #fff;box-shadow:0 0 1px 2px #000}</style><script type="@plotdb/block">module.exports={pkg:{name:"@makeform/image",extend:{name:"@makeform/upload"},dependencies:[{url:"https://cdn.jsdelivr.net/npm/imgtype@0.0.1/index.min.js"}],i18n:{"zh-TW":{"image required":"檔案需為可於瀏覽器中顯示的圖檔"},en:{"image required":"File must be a browser-viewable image."}}},init:function(e){var t,r,i,o,a,h,n,d,u,c,l,g;t=e.ctx,r=e.root,i=e.parent,o=e.t;a=t.imgtype;h={meta:{},crop:{}};n={};d=function(e){var i,l,t;i=e.url,l=e.node;if(t=(n[i]||(n[i]={})).data){return Promise.resolve(t)}if(!l||n[i].running){return new Promise(function(e,t){var r;return((r=n[i]).queue||(r.queue=[])).push({res:e,rej:t})})}n[i].running=true;return new Promise(function(t,e){var d,c;d=new Image;c=function(r){var e;t(n[i].data=r);return((e=n[i]).queue||(e.queue=[])).forEach(function(e){var t;t=e.res;return t(r)})};d.onerror=function(){return c({ratio:1.5,width:150,height:100})};d.onload=function(){var e,t,r,i,n,o,a,u,h;e={width:d.width,height:d.height},t=e.width,r=e.height;i=t/r;n=l.getBoundingClientRect();o={width:{min:200,max:n.width},height:{min:100,max:600<(e=window.innerHeight*.8)?600:e}};a=Math.min(o.height.max/r,o.width.max/t);u=(e=Math.max(o.height.min/r,o.width.min/t))>1?e:1;h=u<a?u:a;t=t*h;r=r*h;return c({ratio:i,width:t,height:r})};return d.src=i})};u=function(n){return new Promise(function(i,t){var e,r;try{e=new FileReader;e.onload=function(){return a(new Uint8Array(e.result)).then(function(e){var t,r;t=e.ext,r=e.mime;return i(!t?{supported:false,message:o("image required")}:{supported:true})})};return e.readAsArrayBuffer(n)}catch(e){r=e;return t(r)}})};c=new ldview({root:r,ctx:{},init:{dialog:function(e){var t;t=e.node;h.ldcv=new ldcover({root:t});h.viewer=ld$.find(t,"[ld=container]",0);return h.open=ld$.find(t,"[ld=open]",0)}},handler:{image:{list:function(e){var t,r;t=e.ctx;r=t.file;if(Array.isArray(r)){return r}else if(r){return[r]}else{return[]}},view:{action:{click:{"@":function(e){var t,r;t=e.ctx;if(h.lightbox.enabled!=null&&!h.lightbox.enabled){return}h.viewer.innerHTML="";r=new Image;r.src=t.url;h.viewer.appendChild(r);h.open.setAttribute("href",t.url);return h.ldcv.toggle()}}},handler:{"@":function(e){var n,t;n=e.node,t=e.ctx;return d({url:t.url,node:n}).then(function(e){var t,r,i;t=e.width,r=e.height,i=e.ratio;return n.classList.toggle("crop",!!h.crop.enabled)})},"image-base":function(e){var n,o;n=e.node,o=e.ctx;return d({url:o.url}).then(function(e){var t,r,i;t=e.width,r=e.height,i=e.ratio;return import$(n.style,!h.crop.enabled?{aspectRatio:"",backgroundImage:""}:{aspectRatio:i,backgroundImage:"url("+o.url+")"})})},image:function(e){var u,t,r;u=e.node,t=e.ctx;u.setAttribute("src",t.url);u.style.opacity=0;if(!h.crop.enabled){r=u.style;r.opacity=1;r.ratio="";r.width="";r.height="";return}return d({url:t.url,node:u}).then(function(e){var t,r,i,n,o,a;t=e.width,r=e.height,i=e.ratio;n={width:h.crop.width,height:h.crop.height};o=n.width/n.height;u.setAttribute("width",n.width);u.setAttribute("height",n.height);a=u.style;a.aspectRatio=o;a.opacity=1;return import$(u.style,o>i?{height:"auto",width:"100%"}:{height:"100%",width:"auto"})})}}}}}});l=function(e){var t;t=e.map(function(a){return new Promise(function(n,e){var o;o=new Image;o.onload=function(){var e,t,r,i;e={width:o.width,height:o.height},t=e.width,r=e.height;i=import$({width:t,height:r},t>r?{long:t,short:r}:{long:r,short:t});i.pixels=i.width*i.height;URL.revokeObjectURL(o.src);return n(import$(a,i))};return o.src=URL.createObjectURL(a.blob)})});return Promise.all(t)};g=function(){var e;if(h.widget){return}h.widget=this;e=function(){h.meta=h.widget.serialize();h.crop=(h.meta.config||{}).crop||{};h.lightbox=(h.meta.config||{}).lightbox||{};return c.render()};e();return this.on("meta",function(){return e()})};return i.ext({view:c,isSupported:u,detail:l,render:g})}};function import$(e,t){var r={}.hasOwnProperty;for(var i in t)if(r.call(t,i))e[i]=t[i];return e}</script><div plug="preview"><div class="ldcv" ld="dialog"><div class="base"><div class="position-absolute d-flex g-2" style="top:1em;right:1em;line-height:1.25em"><a class="clickable" ld="open" data-ldcv-set="" target="_blank" rel="noopener noreferrer"><i class="text-lg i-new-page d-block" style="background:#fff;padding:.5em;border-radius:.25em"></i></a><i class="text-lg i-close d-block clickable" data-ldcv-set="" style="background:#fff;padding:.5em;border-radius:.25em"></i></div><a class="inner d-block" data-ldcv-set="" ld="container"></a></div></div><div class="mb-2 w-100" ld-each="image"><div class="image-base" ld="image-base"><img class="clickable" ld="image" src="data:image/gif;base64,R0lGODlhAwABAIAAAHFxcQAAACH5BAAAAAAALAAAAAADAAEAAAIChAsAOw=="></div></div></div></div>
