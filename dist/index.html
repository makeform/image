<div><style type="text/css">.image-base{background:0}img{max-width:100%;max-height:80vh;width:100%;object-fit:contain}.crop .image-base{display:flex;align-items:center;justify-content:center;background-size:contain;background-position:center center;position:relative}.crop .image-base:before{content:" ";display:block;position:absolute;inset:0;background:#000;background-image:repeating-linear-gradient(45deg,#000 0,#000 5px,#111 5px,#111 10px);opacity:.7;z-index:0}.crop img{z-index:1;object-fit:cover;object-position:center center;width:auto;height:100%;outline:1px solid #fff;box-shadow:0 0 1px 2px #000}</style><script type="@plotdb/block">module.exports={pkg:{name:"@makeform/image",extend:{name:"@makeform/upload"},dependencies:[{url:"https://cdn.jsdelivr.net/npm/imgtype@0.0.1/index.min.js"}]},init:function(t){var e,r,n,o,h,i,u,a,d,c,l;e=t.ctx,r=t.root,n=t.parent;o=e.imgtype;h={meta:{},crop:{}};i={};u=function(t){var n,l,e;n=t.url,l=t.node;if(e=(i[n]||(i[n]={})).data){return Promise.resolve(e)}if(!l||i[n].running){return new Promise(function(t,e){var r;return((r=i[n]).queue||(r.queue=[])).push({res:t,rej:e})})}i[n].running=true;return new Promise(function(e,t){var d,c;d=new Image;c=function(r){var t;e(i[n].data=r);return((t=i[n]).queue||(t.queue=[])).forEach(function(t){var e;e=t.res;return e(r)})};d.onerror=function(){return c({ratio:1.5,width:150,height:100})};d.onload=function(){var t,e,r,n,i,o,u,a,h;t={width:d.width,height:d.height},e=t.width,r=t.height;n=e/r;i=l.getBoundingClientRect();o={width:{min:200,max:i.width},height:{min:100,max:600<(t=window.innerHeight*.8)?600:t}};u=Math.min(o.height.max/r,o.width.max/e);a=(t=Math.max(o.height.min/r,o.width.min/e))>1?t:1;h=a<u?a:u;e=e*h;r=r*h;return c({ratio:n,width:e,height:r})};return d.src=n})};a=function(i){return new Promise(function(n,e){var t,r;try{t=new FileReader;t.onload=function(){return o(new Uint8Array(t.result)).then(function(t){var e,r;e=t.ext,r=t.mime;return n(!e?{supported:false}:{supported:true})})};return t.readAsArrayBuffer(i)}catch(t){r=t;return e(r)}})};d=new ldview({root:r,ctx:{},init:{dialog:function(t){var e;e=t.node;h.ldcv=new ldcover({root:e});h.viewer=ld$.find(e,"[ld=container]",0);return h.open=ld$.find(e,"[ld=open]",0)}},handler:{image:{list:function(t){var e,r;e=t.ctx;r=e.file;if(Array.isArray(r)){return r}else if(r){return[r]}else{return[]}},view:{action:{click:{"@":function(t){var e,r;e=t.ctx;if(h.lightbox.enabled!=null&&!h.lightbox.enabled){return}h.viewer.innerHTML="";r=new Image;r.src=e.url;h.viewer.appendChild(r);h.open.setAttribute("href",e.url);return h.ldcv.toggle()}}},handler:{"@":function(t){var i,e;i=t.node,e=t.ctx;return u({url:e.url,node:i}).then(function(t){var e,r,n;e=t.width,r=t.height,n=t.ratio;return i.classList.toggle("crop",!!h.crop.enabled)})},"image-base":function(t){var i,o;i=t.node,o=t.ctx;return u({url:o.url}).then(function(t){var e,r,n;e=t.width,r=t.height,n=t.ratio;return import$(i.style,!h.crop.enabled?{aspectRatio:"",backgroundImage:""}:{aspectRatio:n,backgroundImage:"url("+o.url+")"})})},image:function(t){var a,e,r;a=t.node,e=t.ctx;a.setAttribute("src",e.url);a.style.opacity=0;if(!h.crop.enabled){r=a.style;r.opacity=1;r.ratio="";r.width="";r.height="";return}return u({url:e.url,node:a}).then(function(t){var e,r,n,i,o,u;e=t.width,r=t.height,n=t.ratio;i={width:h.crop.width,height:h.crop.height};o=i.width/i.height;a.setAttribute("width",i.width);a.setAttribute("height",i.height);u=a.style;u.aspectRatio=o;u.opacity=1;return import$(a.style,o>n?{height:"auto",width:"100%"}:{height:"100%",width:"auto"})})}}}}}});c=function(t){var e;e=t.map(function(u){return new Promise(function(i,t){var o;o=new Image;o.onload=function(){var t,e,r,n;t={width:o.width,height:o.height},e=t.width,r=t.height;n=import$({width:e,height:r},e>r?{long:e,short:r}:{long:r,short:e});n.pixels=n.width*n.height;URL.revokeObjectURL(o.src);return i(import$(u,n))};return o.src=URL.createObjectURL(u.blob)})});return Promise.all(e)};l=function(){var t;if(h.widget){return}h.widget=this;t=function(){h.meta=h.widget.serialize();h.crop=(h.meta.config||{}).crop||{};h.lightbox=(h.meta.config||{}).lightbox||{};return d.render()};t();return this.on("meta",function(){return t()})};return n.ext({view:d,isSupported:a,detail:c,render:l})}};function import$(t,e){var r={}.hasOwnProperty;for(var n in e)if(r.call(e,n))t[n]=e[n];return t}</script><div plug="preview"><div class="ldcv" ld="dialog"><div class="base"><div class="position-absolute d-flex g-2" style="top:1em;right:1em;line-height:1.25em"><a class="clickable" ld="open" data-ldcv-set="" target="_blank" rel="noopener noreferrer"><i class="text-lg i-new-page d-block" style="background:#fff;padding:.5em;border-radius:.25em"></i></a><i class="text-lg i-close d-block clickable" data-ldcv-set="" style="background:#fff;padding:.5em;border-radius:.25em"></i></div><a class="inner d-block" data-ldcv-set="" ld="container"></a></div></div><div class="mb-2 w-100" ld-each="image"><div class="image-base" ld="image-base"><img class="clickable" ld="image" src="data:image/gif;base64,R0lGODlhAwABAIAAAHFxcQAAACH5BAAAAAAALAAAAAADAAEAAAIChAsAOw=="></div></div></div></div>
