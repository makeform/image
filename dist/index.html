<div><style type="text/css">.image-base{background:0}img{max-width:100%;max-height:80vh;width:100%;object-fit:contain}.crop .image-base{display:flex;align-items:center;justify-content:center;background-size:contain;background-position:center center;position:relative}.crop .image-base:before{content:" ";display:block;position:absolute;inset:0;background:#000;background-image:repeating-linear-gradient(45deg,#000 0,#000 5px,#111 5px,#111 10px);opacity:.7;z-index:0}.crop img{z-index:1;object-fit:cover;object-position:center center;width:auto;height:100%;outline:1px solid #fff;box-shadow:0 0 1px 2px #000}</style><script type="@plotdb/block">module.exports={pkg:{name:"@makeform/image",extend:{name:"@makeform/upload"},host:{name:"@grantdash/composer"},dependencies:[{url:"https://cdn.jsdelivr.net/npm/imgtype@0.0.1/index.min.js"}],i18n:{"zh-TW":{"image required":"檔案需為可於瀏覽器中顯示的圖檔",config:{crop:{enabled:{name:"啟用裁切",desc:"若啟用，將基於寬高設定裁切圖片"},width:{name:"圖寬",desc:"裁切時的預期圖寬"},height:{name:"圖高",desc:"裁切時的預期圖高"}},lightbox:{enabled:{name:"啟用燈箱",desc:"若啟用，點擊圖片時將彈出燈箱效果供瀏覽圖片"}}}},en:{"image required":"File must be a browser-viewable image.",config:{crop:{enabled:{name:"enable cropping",desc:"crop image based on ratio derived from width / height below if enabled"},width:{name:"image width",desc:"expected image width when cropped"},height:{name:"image height",desc:"expected image height when copped"}},lightbox:{enabled:{name:"enable lightbox",desc:"toggle a lightbox for previewing when clicking if enabled"}}}}}},client:function(){return{meta:{config:{crop:{enabled:{type:"boolean",default:false,name:"config.crop.enabled.name",desc:"config.crop.enabled.desc"},width:{type:"number",min:1,max:2e3,name:"config.crop.width.name",desc:"config.crop.width.desc"},height:{type:"number",min:1,max:2e3,name:"config.crop.height.name",desc:"config.crop.height.desc"}},lightbox:{enabled:{type:"boolean",default:true,name:"config.lightbox.enabled.name",desc:"config.lightbox.enabled.desc"}}}}}},init:function(e){var t,n,i,o,a,d,r,c,h,u,l,g;t=e.ctx,n=e.root,i=e.parent,o=e.t;a=t.imgtype;d={meta:{},crop:{}};r={};c=function(e){var i,l,t;i=e.url,l=e.node;if(t=(r[i]||(r[i]={})).data){return Promise.resolve(t)}if(!l||r[i].running){return new Promise(function(e,t){var n;return((n=r[i]).queue||(n.queue=[])).push({res:e,rej:t})})}r[i].running=true;return new Promise(function(t,e){var c,u;c=new Image;u=function(n){var e;t(r[i].data=n);return((e=r[i]).queue||(e.queue=[])).forEach(function(e){var t;t=e.res;return t(n)})};c.onerror=function(){return u({ratio:1.5,width:150,height:100})};c.onload=function(){var e,t,n,i,r,o,a,h,d;e={width:c.width,height:c.height},t=e.width,n=e.height;i=t/n;r=l.getBoundingClientRect();o={width:{min:200,max:r.width},height:{min:100,max:600<(e=window.innerHeight*.8)?600:e}};a=Math.min(o.height.max/n,o.width.max/t);h=(e=Math.max(o.height.min/n,o.width.min/t))>1?e:1;d=h<a?h:a;t=t*d;n=n*d;return u({ratio:i,width:t,height:n})};return c.src=i})};h=function(r){return new Promise(function(i,t){var e,n;try{e=new FileReader;e.onload=function(){return a(new Uint8Array(e.result)).then(function(e){var t,n;t=e.ext,n=e.mime;return i(!t?{supported:false,message:o("image required")}:{supported:true})})};return e.readAsArrayBuffer(r)}catch(e){n=e;return t(n)}})};u=new ldview({root:n,ctx:{},init:{dialog:function(e){var t;t=e.node;d.ldcv=new ldcover({root:t});d.viewer=ld$.find(t,"[ld=container]",0);return d.open=ld$.find(t,"[ld=open]",0)}},handler:{image:{list:function(e){var t,n;t=e.ctx;n=t.file;if(Array.isArray(n)){return n}else if(n){return[n]}else{return[]}},view:{action:{click:{"@":function(e){var t,n;t=e.ctx;if(d.lightbox.enabled!=null&&!d.lightbox.enabled){return}d.viewer.innerHTML="";n=new Image;n.src=t.url;d.viewer.appendChild(n);d.open.setAttribute("href",t.url);return d.ldcv.toggle()}}},handler:{"@":function(e){var r,t;r=e.node,t=e.ctx;return c({url:t.url,node:r}).then(function(e){var t,n,i;t=e.width,n=e.height,i=e.ratio;return r.classList.toggle("crop",!!d.crop.enabled)})},"image-base":function(e){var r,o;r=e.node,o=e.ctx;return c({url:o.url}).then(function(e){var t,n,i;t=e.width,n=e.height,i=e.ratio;return import$(r.style,!d.crop.enabled?{aspectRatio:"",backgroundImage:""}:{aspectRatio:i,backgroundImage:"url("+o.url+")"})})},image:function(e){var h,t,n;h=e.node,t=e.ctx;h.setAttribute("src",t.url);h.style.opacity=0;if(!d.crop.enabled){n=h.style;n.opacity=1;n.ratio="";n.width="";n.height="";return}return c({url:t.url,node:h}).then(function(e){var t,n,i,r,o,a;t=e.width,n=e.height,i=e.ratio;r={width:d.crop.width,height:d.crop.height};o=r.width/r.height;h.setAttribute("width",r.width);h.setAttribute("height",r.height);a=h.style;a.aspectRatio=o;a.opacity=1;return import$(h.style,o>i?{height:"auto",width:"100%"}:{height:"100%",width:"auto"})})}}}}}});l=function(e){var t;t=e.map(function(a){return new Promise(function(r,e){var o;o=new Image;o.onload=function(){var e,t,n,i;e={width:o.width,height:o.height},t=e.width,n=e.height;i=import$({width:t,height:n},t>n?{long:t,short:n}:{long:n,short:t});i.pixels=i.width*i.height;URL.revokeObjectURL(o.src);return r(import$(a,i))};return o.src=URL.createObjectURL(a.blob)})});return Promise.all(t)};g=function(){var e;if(d.widget){return}d.widget=this;e=function(){d.meta=d.widget.serialize();d.crop=(d.meta.config||{}).crop||{};d.lightbox=(d.meta.config||{}).lightbox||{};return u.render()};e();return this.on("meta",function(){return e()})};return i.ext({view:u,isSupported:h,detail:l,render:g})}};function import$(e,t){var n={}.hasOwnProperty;for(var i in t)if(n.call(t,i))e[i]=t[i];return e}</script><div plug="preview"><div class="ldcv" ld="dialog"><div class="base"><div class="position-absolute d-flex g-2" style="top:1em;right:1em;line-height:1.25em"><a class="clickable" ld="open" data-ldcv-set="" target="_blank" rel="noopener noreferrer"><i class="text-lg i-new-page d-block" style="background:#fff;padding:.5em;border-radius:.25em"></i></a><i class="text-lg i-close d-block clickable" data-ldcv-set="" style="background:#fff;padding:.5em;border-radius:.25em"></i></div><a class="inner d-block" data-ldcv-set="" ld="container"></a></div></div><div class="mb-2 w-100" ld-each="image"><div class="image-base" ld="image-base"><img class="clickable" ld="image" src="data:image/gif;base64,R0lGODlhAwABAIAAAHFxcQAAACH5BAAAAAAALAAAAAADAAEAAAIChAsAOw=="></div></div></div></div>
